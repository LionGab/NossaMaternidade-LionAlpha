# Regras para Claude Code CLI - Nossa Maternidade

## üß† Sistema de Organiza√ß√£o Estruturado

**IMPORTANTE:** Antes de come√ßar qualquer tarefa, leia o `CONTEXTO.md` na raiz do projeto.

O `CONTEXTO.md` serve como "C√©rebro Externo" - mem√≥ria permanente do projeto. Ele cont√©m:
- Vis√£o e objetivos do projeto
- Regras fundamentais com "porqu√™" expl√≠cito
- Estado atual (m√©tricas, conquistas, bloqueadores)
- Pr√≥ximos passos priorizados
- Stack e arquitetura

**Sistema completo de organiza√ß√£o:**
- `CONTEXTO.md` - C√©rebro Externo (raiz do projeto)
- `docs/ORGANIZACAO/template-plano.md` - Template para planos de fases
- `docs/ORGANIZACAO/fluxo-trabalho.md` - Fluxo completo de 4 fases
- `docs/ORGANIZACAO/templates-prompts.md` - Prompts espec√≠ficos prontos
- `docs/ORGANIZACAO/guia-uso.md` - Guia pr√°tico completo

**Como usar:**
1. No in√≠cio de conversas importantes: "Leia @CONTEXTO.md e use como base"
2. Para tarefas complexas: Use `template-plano.md` para criar plano de fases
3. Para prompts espec√≠ficos: Consulte `templates-prompts.md`
4. Para processo completo: Siga `fluxo-trabalho.md`

## Contexto do Projeto
- **Plataforma**: React Native + Expo (iOS App Store + Android Google Play)
- **N√ÉO √© web**: Apenas componentes React Native nativos
- **Design System**: src/theme/tokens.ts
- **Refer√™ncia Visual**: LAYOUT_COMPLETO_REFERENCIA.md (site web apenas para refer√™ncia)

## Regras Cr√≠ticas de Design

### Tokens Obrigat√≥rios
- ‚úÖ SEMPRE usar `colors` do `useTheme()` hook
- ‚úÖ SEMPRE usar `Spacing` tokens (m√∫ltiplos de 4px)
- ‚úÖ SEMPRE usar `Typography.sizes` e `Typography.weights`
- ‚úÖ SEMPRE usar `Radius` tokens para bordas
- ‚ùå NUNCA valores hardcoded de cor, espa√ßamento ou tipografia

### Componentes Primitivos
- ‚úÖ SEMPRE usar componentes de `src/components/primitives/`
- ‚úÖ Box, Text, Heading, Button, HapticButton, Input
- ‚ùå NUNCA usar View, Text ou TouchableOpacity diretamente (exceto casos espec√≠ficos)

### Acessibilidade WCAG AAA
- ‚úÖ Contraste m√≠nimo 7:1 (texto normal) ou 4.5:1 (texto grande)
- ‚úÖ Alvos de toque m√≠nimos 44x44pt
- ‚úÖ accessibilityLabel em todos os componentes interativos
- ‚úÖ accessibilityHint quando necess√°rio
- ‚úÖ Suporte a Dynamic Type (allowFontScaling)

### Dark Mode
- ‚úÖ SEMPRE implementar suporte completo
- ‚úÖ Todas as cores devem vir do theme context
- ‚úÖ Testar transi√ß√£o entre temas

### Performance Mobile
- ‚úÖ Usar FlatList para listas (n√£o ScrollView com map)
- ‚úÖ useMemo e useCallback quando apropriado
- ‚úÖ Lazy loading de imagens (expo-image)
- ‚úÖ getItemLayout em FlatList quando poss√≠vel

### Responsividade
- ‚úÖ SafeAreaView para iOS notch
- ‚úÖ KeyboardAvoidingView em formul√°rios
- ‚úÖ Flexbox para layout responsivo
- ‚úÖ Testar em m√∫ltiplos tamanhos de tela

## üìù Padr√µes de C√≥digo e Estrutura (TypeScript + React Native + Expo)

### Estilo e Estrutura de C√≥digo

- ‚úÖ Escrever c√≥digo TypeScript conciso e t√©cnico com exemplos precisos
- ‚úÖ Usar padr√µes funcionais e declarativos; evitar classes
- ‚úÖ Preferir itera√ß√£o e modulariza√ß√£o sobre duplica√ß√£o de c√≥digo
- ‚úÖ Usar nomes de vari√°veis descritivos com verbos auxiliares (ex: `isLoading`, `hasError`, `canSubmit`)
- ‚úÖ Estrutura de arquivos: componente exportado, subcomponentes, helpers, conte√∫do est√°tico, tipos
- ‚úÖ Seguir documenta√ß√£o oficial do Expo: https://docs.expo.dev/

### Conven√ß√µes de Nomenclatura

- ‚úÖ Diret√≥rios: lowercase com h√≠fens (ex: `components/auth-wizard`, `screens/chat-screen`)
- ‚úÖ Arquivos: PascalCase para componentes (`HomeScreen.tsx`), camelCase para utilities (`logger.ts`)
- ‚úÖ Preferir exports nomeados para componentes (n√£o default exports)
- ‚úÖ Services: `*Service.ts` (ex: `chatService.ts`, `emotionService.ts`)
- ‚úÖ Hooks: `use*` (ex: `useEmotionTracking.ts`, `useHabits.ts`)

### TypeScript

- ‚úÖ **SEMPRE** usar TypeScript strict mode (`strict: true` no tsconfig.json)
- ‚úÖ **ZERO** `any` types - usar `unknown` + type guards quando necess√°rio
- ‚úÖ Preferir `interface` sobre `type` para objetos
- ‚úÖ Evitar `enum` - usar maps/const objects ao inv√©s
- ‚úÖ Usar componentes funcionais com interfaces TypeScript
- ‚úÖ Tipagem expl√≠cita em props e valores retornados
- ‚ùå NUNCA usar `@ts-ignore` ou `@ts-expect-error` sem justificativa expl√≠cita em coment√°rio

### Sintaxe e Formata√ß√£o

- ‚úÖ Usar palavra-chave `function` para fun√ß√µes puras
- ‚úÖ Evitar chaves desnecess√°rias em condicionais simples; usar sintaxe concisa
- ‚úÖ Usar JSX declarativo
- ‚úÖ Usar Prettier para formata√ß√£o consistente (configurado no projeto)
- ‚úÖ Componentes funcionais sempre (nunca class components)

### UI e Estiliza√ß√£o (Adaptado ao Design System)

- ‚úÖ **SEMPRE** usar componentes primitivos de `src/components/primitives/` (Box, Text, Button, etc.)
- ‚úÖ **SEMPRE** usar design tokens de `src/theme/tokens.ts` (cores, espa√ßamento, tipografia)
- ‚úÖ **SEMPRE** usar `useThemeColors()` para cores theme-aware (suporta dark mode)
- ‚úÖ Implementar design responsivo com Flexbox e `useWindowDimensions` do Expo para ajustes de tela
- ‚úÖ **N√ÉO** usar styled-components - usar NativeWind (Tailwind para React Native) quando necess√°rio
- ‚úÖ Implementar dark mode usando `useColorScheme` do Expo + theme context
- ‚úÖ Garantir alta acessibilidade (a11y) usando props nativas do React Native:
  - `accessibilityLabel` em todos componentes interativos
  - `accessibilityHint` quando necess√°rio
  - `accessibilityRole` apropriado
  - Suporte a Dynamic Type (`allowFontScaling`)
- ‚úÖ Usar `react-native-reanimated` e `react-native-gesture-handler` para anima√ß√µes e gestos perform√°ticos
- ‚ùå **NUNCA** valores hardcoded de cor, espa√ßamento ou tipografia
- ‚ùå **NUNCA** usar `StyleSheet.create` diretamente (usar tokens ou NativeWind)

### Gerenciamento de Safe Area

- ‚úÖ Usar `SafeAreaProvider` de `react-native-safe-area-context` para gerenciar safe areas globalmente
- ‚úÖ Envolver componentes de topo com `SafeAreaView` para lidar com notch, status bar e outros insets
- ‚úÖ Usar `SafeAreaScrollView` para conte√∫do scroll√°vel garantindo respeito aos limites de safe area
- ‚ùå Evitar hardcoding de padding/margins para safe areas - confiar em SafeAreaView e hooks de contexto

### Otimiza√ß√£o de Performance

- ‚úÖ Minimizar uso de `useState` e `useEffect`; preferir Context e reducers para gerenciamento de estado
- ‚úÖ Usar `AppLoading` e `SplashScreen` do Expo para experi√™ncia otimizada de inicializa√ß√£o
- ‚úÖ Otimizar imagens: usar formato WebP onde suportado, incluir dados de tamanho, implementar lazy loading com `expo-image`
- ‚úÖ Implementar code splitting e lazy loading para componentes n√£o-cr√≠ticos com `React.Suspense` e dynamic imports
- ‚úÖ Profile e monitorar performance usando ferramentas built-in do React Native e debugging do Expo
- ‚úÖ Evitar re-renders desnecess√°rios usando `memo()`, `useMemo` e `useCallback` apropriadamente
- ‚úÖ **SEMPRE** usar `FlatList` para listas (nunca `ScrollView` com `map`)
- ‚úÖ Implementar `getItemLayout` em FlatList quando poss√≠vel

### Navega√ß√£o

- ‚úÖ Usar `react-navigation` (v7+) para roteamento e navega√ß√£o
- ‚úÖ Seguir boas pr√°ticas para stack, tab e drawer navigators
- ‚úÖ Aproveitar deep linking e universal links para melhor engajamento e fluxo de navega√ß√£o
- ‚úÖ Usar rotas din√¢micas com `expo-router` quando aplic√°vel (se migrado)

### Gerenciamento de Estado

- ‚úÖ Usar React Context e `useReducer` para gerenciar estado global
- ‚úÖ **SEMPRE** usar React Query (TanStack Query) para data fetching e caching
- ‚úÖ Evitar chamadas excessivas de API - confiar no cache do React Query
- ‚úÖ Para gerenciamento de estado complexo, considerar Zustand ou Redux Toolkit (se necess√°rio)
- ‚úÖ Lidar com par√¢metros de busca de URL usando `expo-linking`
- ‚úÖ Services em `src/services/` devem retornar `{ data, error }` pattern

### Tratamento de Erros e Valida√ß√£o

- ‚úÖ Usar **Zod** para valida√ß√£o runtime e tratamento de erros
- ‚úÖ Implementar logging de erros adequado usando `logger` de `src/utils/logger.ts` (integra com Sentry)
- ‚úÖ Priorizar tratamento de erros e edge cases:
  - Lidar com erros no in√≠cio de fun√ß√µes
  - Usar early returns para condi√ß√µes de erro (evitar ifs aninhados profundos)
  - Evitar statements `else` desnecess√°rios; usar padr√£o if-return
  - Implementar error boundaries globais para capturar erros inesperados
- ‚úÖ Usar `expo-error-reporter` ou Sentry para logging e report de erros em produ√ß√£o
- ‚úÖ **NUNCA** usar `console.log` - sempre usar `logger.info()`, `logger.error()`, etc.

### Testes

- ‚úÖ Escrever testes unit√°rios usando Jest e React Native Testing Library
- ‚úÖ Implementar testes de integra√ß√£o para fluxos cr√≠ticos de usu√°rio usando Detox (quando aplic√°vel)
- ‚úÖ Usar ferramentas de teste do Expo para rodar testes em diferentes ambientes
- ‚úÖ Considerar snapshot testing para componentes para garantir consist√™ncia de UI
- ‚úÖ **Toda fun√ß√£o precisa de unit test** em `__tests__/`
- ‚úÖ Coverage m√≠nimo: 40% MVP, 60% Phase 2, 80% final
- ‚úÖ Testar services primeiro (IA, Supabase, etc) com mocks

### Seguran√ßa

- ‚úÖ Sanitizar inputs de usu√°rio para prevenir ataques XSS
- ‚úÖ Usar `react-native-encrypted-storage` ou `expo-secure-store` para armazenamento seguro de dados sens√≠veis
- ‚úÖ Garantir comunica√ß√£o segura com APIs usando HTTPS e autentica√ß√£o adequada
- ‚úÖ Seguir guidelines de seguran√ßa do Expo: https://docs.expo.dev/guides/security/
- ‚úÖ **SEMPRE** RLS policies no Supabase (LGPD compliance)
- ‚úÖ Validar todas entradas de usu√°rio com Zod

### Internacionaliza√ß√£o (i18n)

- ‚úÖ Usar `expo-localization` para internacionaliza√ß√£o e localiza√ß√£o
- ‚úÖ Suportar m√∫ltiplos idiomas e layouts RTL (se necess√°rio)
- ‚úÖ Garantir escalabilidade de texto e ajustes de fonte para acessibilidade
- ‚úÖ Textos em portugu√™s brasileiro (pt-BR) como padr√£o

### Conven√ß√µes Principais do Projeto

1. ‚úÖ Confiar no managed workflow do Expo para desenvolvimento e deploy simplificados
2. ‚úÖ Priorizar Mobile Web Vitals (Load Time, Jank, Responsiveness)
3. ‚úÖ Usar `expo-constants` para gerenciar vari√°veis de ambiente e configura√ß√£o
4. ‚úÖ Usar `expo-permissions` para lidar com permiss√µes de dispositivo graciosamente
5. ‚úÖ Implementar `expo-updates` para over-the-air (OTA) updates
6. ‚úÖ Seguir boas pr√°ticas do Expo para deploy e publica√ß√£o: https://docs.expo.dev/distribution/introduction/
7. ‚úÖ Garantir compatibilidade com iOS e Android testando extensivamente em ambas plataformas
8. ‚úÖ **SEMPRE** usar componentes primitivos do design system
9. ‚úÖ **SEMPRE** usar design tokens (nunca valores hardcoded)
10. ‚úÖ **SEMPRE** implementar dark mode

### Documenta√ß√£o de API

- ‚úÖ Referenciar documenta√ß√£o oficial do Expo: https://docs.expo.dev/
- ‚úÖ Consultar documenta√ß√£o do Supabase: https://supabase.com/docs
- ‚úÖ Consultar documenta√ß√£o do React Navigation: https://reactnavigation.org/

## Valida√ß√£o Antes de Commit

Antes de aceitar mudan√ßas, sempre valide:

### Design System
1. ‚úÖ Tokens de design usados corretamente? (cores, espa√ßamento, tipografia)
2. ‚úÖ Dark mode implementado e testado?
3. ‚úÖ Acessibilidade WCAG AAA? (contraste, touch targets, labels)
4. ‚úÖ Componentes primitivos usados? (n√£o View/Text direto)
5. ‚úÖ Nenhum valor hardcoded? (cores, espa√ßamento, tamanhos)

### C√≥digo e TypeScript
6. ‚úÖ TypeScript strict mode? (`npm run type-check` ‚Üí 0 errors)
7. ‚úÖ Zero `any` types? (usar `unknown` + type guards)
8. ‚úÖ ESLint sem erros cr√≠ticos? (`npm run lint`)
9. ‚úÖ Nenhum `console.log`? (usar `logger`)

### Arquitetura
10. ‚úÖ Services retornam `{ data, error }` pattern?
11. ‚úÖ React Query usado para data fetching?
12. ‚úÖ Componentes s√£o funcionais e apresentacionais?
13. ‚úÖ L√≥gica de neg√≥cio em services (n√£o em componentes)?

### Performance e UX
14. ‚úÖ Performance otimizada? (FlatList, memo, useMemo, useCallback)
15. ‚úÖ Responsividade testada? (m√∫ltiplos tamanhos de tela)
16. ‚úÖ Safe areas tratadas? (SafeAreaView, SafeAreaProvider)
17. ‚úÖ Loading e error states implementados?

### Testes e Qualidade
18. ‚úÖ Testes unit√°rios para l√≥gica de neg√≥cio?
19. ‚úÖ Coverage m√≠nimo atingido? (40% MVP, 60% Phase 2, 80% final)
20. ‚úÖ Valida√ß√£o de inputs com Zod?

### Seguran√ßa e Compliance
21. ‚úÖ RLS policies no Supabase? (LGPD compliance)
22. ‚úÖ Inputs sanitizados? (preven√ß√£o XSS)
23. ‚úÖ Dados sens√≠veis em storage seguro?

## Refer√™ncias Obrigat√≥rias

- **C√©rebro Externo:** `CONTEXTO.md` (raiz do projeto) - **LEIA PRIMEIRO**
- **Design System (Fonte √önica da Verdade):**
  - `docs/design/DESIGN_PRINCIPLES.md` - Princ√≠pios fundamentais de design
  - `docs/design/DESIGN_SYSTEM_REFERENCE.md` - Guia definitivo do sistema
  - `docs/design/COMPONENT_PATTERNS.md` - Padr√µes de componentes
  - `docs/design/DESIGN_DECISIONS.md` - Decis√µes estabelecidas (cores, espa√ßamento, etc.)
  - `docs/design/DESIGN_QUICK_REFERENCE.md` - Cheat sheet r√°pido
- Design System Tokens: `src/theme/tokens.ts`
- Layout Completo: `LAYOUT_COMPLETO_REFERENCIA.md`
- Guia Mobile: `MOBILE_IMPLEMENTATION_GUIDE.md`
- Prompts: `PROMPTS_DESIGN_VALIDATION.md`
- Sistema de Organiza√ß√£o: `docs/ORGANIZACAO/` (templates, fluxos, guias)

## üé® Documenta√ß√£o de Design (Fonte √önica da Verdade)

**IMPORTANTE:** Quando houver d√∫vida sobre design, cores, espa√ßamento, tipografia ou padr√µes de componentes, consulte a documenta√ß√£o de design em `docs/design/`. Esta documenta√ß√£o elimina ambiguidades e estabelece decis√µes definitivas.

**Documentos de Design:**
1. **DESIGN_PRINCIPLES.md** - Filosofia, valores, objetivos e princ√≠pios fundamentais
2. **DESIGN_SYSTEM_REFERENCE.md** - Guia completo do sistema moderno, hierarquia e padr√µes de uso
3. **COMPONENT_PATTERNS.md** - Padr√µes obrigat√≥rios para cria√ß√£o de componentes (Atomic Design)
4. **DESIGN_DECISIONS.md** - Todas as decis√µes estabelecidas (cores, tipografia, espa√ßamento, etc.)
5. **DESIGN_QUICK_REFERENCE.md** - Cheat sheet r√°pido para desenvolvimento

**Regra de Ouro:** N√£o "adivinhe" decis√µes de design. Tudo est√° documentado em `docs/design/`. Consulte primeiro, depois implemente.

## Otimiza√ß√£o Claude no Cursor

### Configura√ß√µes Recomendadas
- ‚úÖ Modelo padr√£o: Claude Sonnet 4.5 (melhor custo/benef√≠cio)
- ‚úÖ Codebase Indexing: Ativo para melhor contexto
- ‚úÖ Context Window: Large (8192 tokens)
- ‚úÖ Configura√ß√µes em: `.cursor/settings.json`

### Uso Eficiente
- ‚úÖ Use `@mentions` para contexto espec√≠fico (`@arquivo.tsx`, `@pasta/`)
- ‚úÖ Inicie novas conversas para novos t√≥picos
- ‚úÖ Use Composer (Cmd+Shift+I) para edi√ß√µes multi-arquivo
- ‚úÖ Agrupe perguntas relacionadas
- ‚ùå Evite conversas muito longas (economiza tokens)

### Verifica√ß√£o
- Execute `npm run verify:cursor` para verificar configura√ß√£o
- Consulte `docs/CURSOR_CLAUDE_SETUP.md` para guia completo

## Lembrete Constante

Este √© um projeto MOBILE (iOS/Android), n√£o web. Todo c√≥digo deve ser React Native nativo.

---

## üìö Nota sobre Integra√ß√£o de Regras

As regras acima foram adaptadas e integradas ao contexto espec√≠fico do projeto **Nossa Maternidade**:
- ‚úÖ Adaptadas para React Native + Expo (n√£o web)
- ‚úÖ Integradas com o design system espec√≠fico (`src/theme/tokens.ts`)
- ‚úÖ Alinhadas com TypeScript strict mode e zero `any`
- ‚úÖ Compat√≠veis com arquitetura existente (Services, Hooks, Components)
- ‚úÖ Respeitam padr√µes de Supabase + IA multi-provider
- ‚úÖ Mant√™m foco em componentes primitivos do projeto

**Refer√™ncia:** Regras baseadas em melhores pr√°ticas de TypeScript, React Native, Expo e Mobile UI development, adaptadas ao contexto do projeto.
