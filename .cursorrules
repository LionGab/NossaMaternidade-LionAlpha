---
description: "React Native Component Rules ‚Äì Nossa Maternidade"
globs: ["src/**/*.tsx"]
alwaysApply: false
---

Use componentes de primitives em `src/components/primitives` para √°tomos (Box, Text, Button, etc.).
Componentes em `src/components` (primitives/molecules/organisms/templates) devem ser majoritariamente apresentacionais.
Toda l√≥gica de neg√≥cio e comunica√ß√£o com backend deve ficar em `src/services` (e hooks em `src/hooks`).

---

## üéØ REGRAS ESSENCIAIS (Essential Rules)

| Categoria | Regra |
|-----------|-------|
| **Tech Stack** | Use NativeWind (Tailwind para React Native). Nunca styled-components ou StyleSheet.create. |
| **Architecture** | Services em `src/services`, UI em `src/components`. Hooks em `src/hooks`. |
| **Anti-Lazy** | Output FULL file. Sem placeholders. Sem `//...existing code`. Sempre c√≥digo completo. |
| **Testing** | Toda fun√ß√£o precisa de unit test em `__tests__/`. Coverage m√≠nimo: 40% MVP, 60% Phase 2, 80% final. |
| **Design Tokens** | Use APENAS `@/theme/tokens` (Tokens, ColorTokens, useThemeColors()). NUNCA `@/design-system` (legado). |
| **TypeScript** | Strict mode sempre. Zero `any`. Use `unknown` + type guards. |
| **Logging** | Use `logger.info()`, `logger.error()` de `src/utils/logger.ts`. Nunca `console.log`. |

---

## üö´ THE ANTI-LAZY PROMPT (Reddit Gold)

Voc√™ √© um engenheiro expert.
Voc√™ N√ÉO usa placeholders.
Voc√™ outputa o CONTE√öDO COMPLETO do arquivo toda vez.
Voc√™ n√£o √© pregui√ßoso.
Voc√™ sempre mostra c√≥digo completo, n√£o coment√°rios como `// ... existing code ...` ou `// ... more code ...`.
Quando editar um arquivo, mostre o contexto completo necess√°rio para entender a mudan√ßa.

---

Perfeito! Analisei o documento. Agora vou criar um PROMPT ULTRA-ROBUSTO PARA CURSOR AI que sintetiza tudo: context do projeto, stack, plano de a√ß√£o, integra√ß√£o Supabase + IA multi-provider, e melhores pr√°ticas de Cursor.


üéØ PROMPT ROBUSTO PARA CURSOR AI - Nossa Maternidade
Cole este prompt todo na chat do Cursor AI (ou use como .cursor/rules):

# üî• CONTEXTO COMPLETO: Our Maternidade (Nossa Maternidade)

## PROJETO
App mobile React Native + Expo + TypeScript para m√£es brasileiras.
- **Prop√≥sito:** Apoio emocional, comunidade, autocuidado, IA amig√°vel (NathIA)
- **P√∫blico:** M√£es 18-45 anos, classes C-D, Brasil (LGPD)
- **Status:** MVP funcional existe (repo: LionGab/NossaMaternidade), precisa refatora√ß√£o + features
- **Vers√£o app:** Expo 51+, React Native 0.75+, TypeScript 5.7+ (strict mode)

---

## STACK CONFIRMADA

### Frontend
- **Framework:** React Native + Expo (managed, SDK 51+)
- **Language:** TypeScript 5.7+ (strict, zero `any`)
- **Styling:** NativeWind (Tailwind para RN) + design tokens centralizados
- **Navigation:** React Navigation 6+ (Stack + Tab)
- **State:** TanStack Query (React Query) para sync Supabase
- **UI Lib:** Componentes customizados (Box, Text, Button, Card) em `src/components`
- **Theme:** "Bubblegum" design system (azul pastel #B3D9E8, rosa, verde seguran√ßa)
- **Testing:** Jest + React Native Testing Library (60%+ MVP)

### Backend
- **Database:** Supabase (PostgreSQL) + RLS policies (LGPD)
- **Auth:** Supabase Auth (magic links + social)
- **Storage:** Supabase Storage (avatares, thumbs)
- **Realtime:** Supabase Realtime (comunidade live)
- **Edge Functions:** Supabase Edge Functions (Deno) para orquestra√ß√£o IA

### IA Stack (Multi-Provider + Fallback)
| Caso | Primary | Fallback 1 | Fallback 2 |
|------|---------|-----------|-----------|
| Chat NathIA (default) | Gemini 2.5 Flash | GPT-4o | Claude Opus |
| Crise emocional | GPT-4o (OpenAI safety) | Gemini thinking | Claude Opus |
| An√°lise profunda | Gemini 2.5 Flash thinking | Claude Opus | ‚Äî |
| Embeddings | Gemini 1.5 | OpenAI text-embed-3 | ‚Äî |
| Modera√ß√£o conte√∫do | Claude API | OpenAI Moderation | ‚Äî |

**Arquitetura IA:**
- `llmRouter.ts`: Decide provider baseado em contexto (crise? ‚Üí GPT-4o; normal? ‚Üí Gemini)
- `MaternalChatAgent` + `ContentRecommendationAgent` + `HabitsAnalysisAgent`: Orquestra√ß√£o
- MCP architecture: SupabaseMCP, GoogleAIMCP, OpenAIMCP, AnthropicMCP
- Prompt registry centralizado: `/src/ai/prompts/`
- Fallback autom√°tico: se provedor cai, tenta pr√≥ximo

---

## ESTRUTURA DE PASTAS ESPERADA


NossaMaternidade/
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ app/ # App.tsx, navega√ß√£o root
‚îÇ ‚îú‚îÄ‚îÄ screens/ # HomeScreen, ChatScreen, OnboardingScreen, ProfileScreen, etc
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ HomeScreen.tsx
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ChatScreen.tsx
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ MundoNathScreen.tsx
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ HabitsScreen.tsx
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ MaesValenteScreen.tsx (comunidade)
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ SettingsScreen.tsx
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ components/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ primitives/ # Atoms: Box, Text, Button, HapticButton, ProgressIndicator
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ molecules/ # Molecules: Avatar, Badge, EmotionalPrompt, Card variants
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ organisms/ # Organisms: MaternalCard (hero|insight|action|progress|content)
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ templates/ # Templates: ScreenLayout, SectionLayout
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ services/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ supabase/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ profileService.ts
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ chatService.ts
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ emotionService.ts
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ habitService.ts
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ contentService.ts
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ai/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ llmRouter.ts
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ aiOrchestrator.ts
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ aiFallback.ts
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ geminiService.ts (legacy, manter compat√≠vel)
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ ai/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ config/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ llmConfig.ts # Profiles: CHAT_DEFAULT, CRISIS_SAFE, ANALYSIS_DEEP
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ llmRouter.ts # Roteamento inteligente
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ agents/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ MaternalChatAgent.ts
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ContentRecommendationAgent.ts
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ HabitsAnalysisAgent.ts
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ prompts/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ nathia.system.md # Sistema prompt principal
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ crisis.system.md # Para crise emocional
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ moderation.system.md # Para mod de conte√∫do
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ moderation/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ MedicalModerationService.ts
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ theme/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ colors.ts # Paleta: Bubblegum (azul, rosa, verde)
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ typography.ts # Font sizes, weights
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ spacing.ts # Grid 4px, margins/paddings
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ tokens.ts # Design system centralizado
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ types/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ user.ts # UserProfile, EmotionValue, LifeStage
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ai.ts # LlmProfile, RoutingContext, CrisisFlags
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ content.ts # ContentItem, Post, Comment
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ index.ts # Exports
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ hooks/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ useAIRouting.ts
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ useEmotionTracking.ts
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ useHabits.ts
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ useSupabase.ts
‚îÇ ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ utils/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ logger.ts # Logging (n√£o usar console.log)
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ ai.ts # Helper functions
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ supabase.ts # Client setup
‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ constants/
‚îÇ ‚îú‚îÄ‚îÄ colors.ts # Refer√™ncia de cores (use tokens.ts)
‚îÇ ‚îú‚îÄ‚îÄ emotions.ts # 5 emojis, labels
‚îÇ ‚îî‚îÄ‚îÄ onboarding.ts # Perguntas da onboarding
‚îÇ
‚îú‚îÄ‚îÄ supabase/
‚îÇ ‚îú‚îÄ‚îÄ migrations/ # SQL versionadas
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ 001_initial_schema.sql
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ 002_rls_policies.sql
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ 003_indexes_performance.sql
‚îÇ ‚îî‚îÄ‚îÄ functions/
‚îÇ ‚îú‚îÄ‚îÄ chat/ # Orquestra√ß√£o NathIA
‚îÇ ‚îú‚îÄ‚îÄ emotion-log/ # Check-in emocional
‚îÇ ‚îú‚îÄ‚îÄ moderate-content/ # Modera√ß√£o IA
‚îÇ ‚îî‚îÄ‚îÄ profile-complete/ # Onboarding 15Q
‚îÇ
‚îú‚îÄ‚îÄ .cursor/
‚îÇ ‚îî‚îÄ‚îÄ rules # Regras Cursor (opcional, ver section)
‚îÇ
‚îú‚îÄ‚îÄ app.json # Expo config
‚îú‚îÄ‚îÄ package.json # Dependencies
‚îú‚îÄ‚îÄ tsconfig.json # TypeScript config (strict)
‚îú‚îÄ‚îÄ jest.config.js # Testing config
‚îú‚îÄ‚îÄ .env.example # Vari√°veis de ambiente
‚îî‚îÄ‚îÄ README.md # Documenta√ß√£o (j√° existe)

---

## PLANO DE A√á√ÉO (3 Fases)

### Fase 1: MVP B√°sico (Semanas 1-4) ‚úÖ Prioridade 1
**Objetivo:** App funcional, TypeScript 0 erros, Home + Chat + Emocional + H√°bitos

#### Week 1-2: Setup + TypeScript Clean
- [ ] Clonar repo, atualizar Expo para SDK 54+
- [ ] **Corrigir todos erros TypeScript** (currently 16 errors via BUG_FIX_PLAN)
  - Run: `npm run type-check 2>&1 | grep "error TS" | wc -l`
  - Must be: 0
- [ ] Limpar `src/` e `supabase/types` de `any`
- [ ] Setup Supabase (schema MVP: user_profiles, chat_messages, emotion_logs, habits, content_interactions)
- [ ] Create RLS policies (LGPD-ready)

#### Week 2-3: Onboarding + Home + Design System
- [ ] Implementar OnboardingScreen (2 perguntas cr√≠ticas: name, life_stage)
- [ ] Refatorar HomeScreen para 6 blocos (sauda√ß√£o, Hero CTA, emocional, di√°rio, h√°bitos, mundo nath)
- [ ] Create MaternalCard component (6 variants: hero, insight, action, progress, content, emotional)
- [ ] Create EmotionalPrompt (5 emojis, haptic feedback)
- [ ] Aplicar design tokens em todas as telas (use `src/theme/tokens.ts`)

#### Week 3-4: Chat NathIA + Emotions + Supabase Integration
- [ ] Implementar ChatScreen com NathIA (Gemini default)
- [ ] Create `emotionService.ts` + hook `useEmotionTracking`
- [ ] Create `habitService.ts` + habit logging
- [ ] Connect HomeScreen a Supabase (profile, emotions, habits)
- [ ] Add offline cache (AsyncStorage para fallback)
- [ ] Tests: 40%+ coverage (services + components)

**Resultado Week 4:** App com home, chat, check-in emocional, logging Supabase, 0 TS errors

---

### Fase 2: Amplia√ß√£o + Refinement (Semanas 5-8) ‚úÖ Prioridade 2
**Objetivo:** Feed personalizado, Profile completo, IA avan√ßada, 60%+ test coverage

#### Week 5-6: MundoNath Feed + Content Interactions
- [ ] Implementar MundoNathScreen (3 cards preview na Home, full feed em tela)
- [ ] Create `contentService.ts` (log view, like, share, bookmark)
- [ ] Content algo (iniciar simples: popular + recente)
- [ ] Add content_interactions logging ao Supabase

#### Week 6-7: Profile Completo + IA Routing
- [ ] Implementar ProfileScreen com 15 perguntas opcionais
- [ ] Expandir llmRouter (ligar modes do chat a diferentes modelos)
  - "Chat Normal" ‚Üí Gemini Flash
  - "Pensar" ‚Üí Claude Opus
  - "Pesquisar" ‚Üí Gemini com reasoning
  - "Crise" ‚Üí GPT-4o (OpenAI safety)
- [ ] Add fallback autom√°tico entre providers
- [ ] Implementar crisis detection (keywords + risk flags)
- [ ] Add disclaimer m√©dico din√¢mico

#### Week 7-8: Design System + Dark Mode + Acessibilidade
- [ ] Uniformizar todas as telas com design tokens
- [ ] Implementar Dark Mode (toggle em Settings)
- [ ] WCAG AAA compliance: contrast ratios, touch targets 44pt+, accessibility labels
- [ ] Testes: 60%+ coverage (todos services, principais screens)
- [ ] Fix ESLint warnings cr√≠ticos

**Resultado Week 8:** App com feed, profile, IA multi-provider, acessibilidade WCAG AAA

---

### Fase 3: Comunidade + Lan√ßamento (Semanas 9-12) ‚úÖ Prioridade 3
**Objetivo:** Comunidade moderada, embeddings, pronto para App Store

#### Week 9-10: M√£esValente (Comunidade)
- [ ] Implementar MaesValenteScreen (posts, coment√°rios, an√¥nimos)
- [ ] Create `communityService.ts` (create post, comment, like, moderation)
- [ ] Integrar IA modera√ß√£o: detecta viol√™ncia, hate, sensibilidade
- [ ] Add labels din√¢micos ("Conte√∫do sens√≠vel ‚Äî deseja ver?")
- [ ] Implementar trust scoring (usu√°rias com posts apoiadores ganham badge)

#### Week 10-11: Embeddings + Semantic Search
- [ ] Integrar pgvector no Supabase
- [ ] Implementar `embeddingService.ts` (Gemini Embeddings API)
- [ ] Criar profile vector (prefer√™ncias + history)
- [ ] Semantic search para MundoNath (top-K similar content)
- [ ] Personalizar feed com explica√ß√£o ("Escolhemos isso porque voc√™...")

#### Week 11-12: Polish + Lan√ßamento
- [ ] Analytics dashboard (DAU, churn, sentiment)
- [ ] Sentry setup (error tracking)
- [ ] Build final (iOS + Android)
- [ ] App Store + Google Play submission
- [ ] Beta testing com 50+ m√£es
- [ ] 80%+ test coverage

**Resultado Week 12:** App pronto para lan√ßamento p√∫blico

---

## MELHORES PR√ÅTICAS DO CURSOR AI (Como Usar)

### 1. Comece com Context

Sempre comece conversas no Cursor com:
- Arquivo que est√° editando: `@app.tsx` (ou o arquivo espec√≠fico)
- Contexto do projeto: Este √© um app maternal React Native + Expo
- Objetivo desta tarefa: "Criar MaternalCard component com 6 variants"

### 2. Use @mentions Eficientemente

- `@app.tsx` - Refer√™ncia ao arquivo principal
- `@package.json` - Para ver depend√™ncias
- `@tsconfig.json` - Para entender tipos
- `@src/theme` - Refer√™ncia √† pasta inteira
- `@src/services` - Para ver padr√µes de services

### 3. Pe√ßa Refatora√ß√µes Espec√≠ficas

‚ùå RUIM: "Refatore este arquivo"
‚úÖ BOM: "Refatore HomeScreen.tsx para usar design tokens em vez de hardcoded colors.
Mantenha mesma funcionalidade, apenas style updates."
‚ùå RUIM: "Crie um componente"
‚úÖ BOM: "Crie MaternalCard.tsx em src/components/organisms com 6 variants
(hero, insight, action, progress, content, emotional). Use apenas primitives
(Box, Text, Button) de src/components/primitives. TypeScript strict mode."

### 4. Use Composer para Multi-File Edits

Usar Cursor Composer (Cmd+Shift+I no Mac) quando:
- Criar m√∫ltiplos arquivos relacionados (ex: MaternalCard + types + tests)
- Refatorar entre pastas (ex: mover services, atualizar imports)
- Setup inicial (pastas + boilerplate)

### 5. Pe√ßa Type-First Development

Sempre pe√ßa tipos ANTES de implementa√ß√£o:
```
"Crie types/ai.ts com interfaces: LlmProfile, RoutingContext, CrisisFlags.
Ent√£o use em src/ai/config/llmConfig.ts"
```

### 6. Commit Messages Cursor-Style

Cursor entende contexto entre commits. Pe√ßa assim:
```
"Ap√≥s criar MaternalCard.tsx, fa√ßa commit:
'feat(ui): MaternalCard organism component (6 variants, Atomic Design'"
```

### 7. Debugging com Cursor

Quando algo quebra:
```
"A HomeScreen t√° com erro ao renderizar MaternalCard.
O erro √©: [copie erro]. Arquivo: @src/screens/HomeScreen.tsx.
Qual √© o problema?"
```

### 8. Testing Pattern

Cursor escreve testes se pedir:
```
"Crie tests para @src/services/emotionService.ts.
Test: saveEmotion() deve persistir em Supabase.
Test: getTodayEmotion() deve retornar emotion de hoje."
```

---

## REGRAS CR√çTICAS DO PROJETO

### Anti-Lazy (C√≥digo Completo)
- ‚úÖ Sempre outputar c√≥digo COMPLETO do arquivo
- ‚úÖ Sem placeholders como `// ... existing code ...` ou `// ... more code ...`
- ‚úÖ Sempre mostrar contexto suficiente para entender a mudan√ßa
- ‚úÖ Quando editar, mostrar a fun√ß√£o/classe completa, n√£o apenas a linha alterada
- ‚ùå Nunca usar coment√°rios para omitir c√≥digo relevante

### TypeScript
- ‚úÖ `strict: true` sempre
- ‚úÖ Zero `any`
- ‚úÖ Use `unknown` + type guards
- ‚ùå Sem `// @ts-ignore` ou `@ts-expect-error`

### Naming
- Services: `*Service.ts` (profileService, chatService)
- Screens: `*Screen.tsx` (HomeScreen, ChatScreen)
- Components: `*Component.tsx` ou `*Organism.tsx` (MaternalCard, EmotionalPrompt)
- Hooks: `use*` (useAIRouting, useEmotionTracking)

### Logging
- ‚úÖ Use `logger.info()`, `logger.error()` (from utils/logger.ts)
- ‚ùå Nunca `console.log`

### Styling
- ‚úÖ Use design tokens (`src/theme/tokens.ts`)
- ‚úÖ NativeWind (Tailwind para React Native) para consistency
- ‚úÖ Use `className` com classes Tailwind via NativeWind
- ‚ùå Nunca styled-components ou styled-components/native
- ‚ùå Hardcoded colors/sizes (`#FFFFFF`, `rgba(...)`, `16`, etc.)
- ‚ùå StyleSheet.create (use tokens diretamente ou NativeWind)

### IA Integrations
- ‚úÖ Sempre rote via `llmRouter.ts`
- ‚úÖ Log cada chamada (provider, tokens, cost)
- ‚úÖ Fallback autom√°tico
- ‚úÖ Crisis detection antes de qualquer resposta
- ‚ùå Diagn√≥stico m√©dico sem disclaimer

### Supabase
- ‚úÖ RLS policies em TODAS as tables
- ‚úÖ Migrations versionadas
- ‚úÖ EdgeFunctions para l√≥gica complexa
- ‚úÖ AsyncStorage para offline cache
- ‚ùå Queries sem √≠ndices (perf killer)

### Testing
- ‚úÖ Jest + React Native Testing Library
- ‚úÖ **Toda fun√ß√£o precisa de unit test** em `__tests__/`
- ‚úÖ Test services first (IA, Supabase, etc)
- ‚úÖ Mock Supabase (n√£o use DB real em testes)
- ‚úÖ Coverage m√≠nimo: 40% MVP, 60% Phase 2, 80% final
- ‚ùå Fun√ß√µes sem testes n√£o s√£o aceitas

### Arquitetura de Componentes React/React Native ‚ö†Ô∏è CR√çTICO

**Separa√ß√£o de Responsabilidades:**

1. **Componentes em `src/components` s√£o APENAS apresentacionais:**
   - ‚úÖ Recebem props e renderizam UI
   - ‚úÖ Podem usar hooks de UI (`useState`, `useRef`, `useMemo` para performance)
   - ‚úÖ Podem usar hooks customizados de `src/hooks` para l√≥gica reutiliz√°vel
   - ‚ùå N√ÉO fazem chamadas diretas a APIs ou Supabase
   - ‚ùå N√ÉO cont√™m l√≥gica de neg√≥cio complexa
   - ‚ùå N√ÉO fazem transforma√ß√µes de dados al√©m de formata√ß√£o de display

2. **L√≥gica de neg√≥cio vai em `src/services`:**
   - ‚úÖ Services fazem chamadas a APIs, Supabase, IA
   - ‚úÖ Services cont√™m regras de neg√≥cio, valida√ß√µes, transforma√ß√µes de dados
   - ‚úÖ Services s√£o test√°veis isoladamente (mocks f√°ceis)
   - ‚úÖ Services podem ser usados por m√∫ltiplos componentes

3. **Hooks em `src/hooks` s√£o bridges entre UI e Services:**
   - ‚úÖ Hooks encapsulam l√≥gica reutiliz√°vel que combina services + estado UI
   - ‚úÖ Exemplos: `useEmotionTracking`, `useHabits`, `useSupabase`
   - ‚úÖ Podem usar TanStack Query para cache/sync
   - ‚ùå N√£o devem conter l√≥gica de neg√≥cio complexa (isso vai em services)

4. **Primitives em `src/components/primitives`:**
   - ‚úÖ √Åtomos b√°sicos: Box, Text, Button, Input, etc.
   - ‚úÖ Devem ser completamente gen√©ricos e reutiliz√°veis
   - ‚úÖ Podem usar shadcn/ui como base (se adaptado para React Native)
   - ‚úÖ Zero depend√™ncias de neg√≥cio

**Exemplo Correto:**
```typescript
// ‚úÖ CORRETO: Componente apresentacional
// src/components/organisms/MaternalCard.tsx
import { useEmotionTracking } from '@/hooks/useEmotionTracking';

export const MaternalCard = ({ variant }: Props) => {
  const { todayEmotion } = useEmotionTracking(); // Hook usa service internamente
  
  return (
    <Box>
      <Text>{todayEmotion?.label}</Text>
    </Box>
  );
};

// ‚úÖ CORRETO: Service com l√≥gica de neg√≥cio
// src/services/supabase/emotionService.ts
export const emotionService = {
  async saveEmotion(emotion: EmotionValue) {
    // L√≥gica de neg√≥cio aqui
    return await supabase.from('emotion_logs').insert(emotion);
  }
};

// ‚úÖ CORRETO: Hook que conecta UI e Service
// src/hooks/useEmotionTracking.ts
export const useEmotionTracking = () => {
  const { data } = useQuery({
    queryKey: ['emotion', 'today'],
    queryFn: () => emotionService.getTodayEmotion()
  });
  return { todayEmotion: data };
};
```

**Exemplo Incorreto:**
```typescript
// ‚ùå ERRADO: Componente com l√≥gica de neg√≥cio
export const MaternalCard = () => {
  const [emotion, setEmotion] = useState();
  
  useEffect(() => {
    // ‚ùå Chamada direta ao Supabase no componente
    supabase.from('emotion_logs').select().then(setEmotion);
  }, []);
  
  return <Text>{emotion?.label}</Text>;
};
```

### Design System Validation Protocol ‚ö†Ô∏è CR√çTICO

**SEMPRE que modificar componentes, telas ou estilos:**

1. ‚úÖ Use APENAS `@/theme/tokens` (NUNCA `@/design-system` - sistema legado)
2. ‚úÖ Use `useThemeColors()` para cores theme-aware (suporta dark mode)
3. ‚úÖ Valide contraste WCAG AAA (7:1 m√≠nimo para text, 4.5:1 para large text)
4. ‚úÖ Touch targets >= 44pt (iOS) / 48dp (Android)
5. ‚úÖ Rode `@design-tokens validate FILE` antes de commit
6. ‚úÖ Rode `@accessibility audit.screen FILE` para telas completas
7. ‚úÖ Teste dark mode (use `isDark` do `useTheme()` hook)

**MCPs de Valida√ß√£o Dispon√≠veis:**
```bash
# Valida√ß√£o de design tokens
@design-tokens validate src/screens/HomeScreen.tsx

# An√°lise de qualidade de c√≥digo
@code-quality analyze.design src/components/Button.tsx

# Auditoria de acessibilidade WCAG AAA
@accessibility audit.screen src/screens/ChatScreen.tsx

# Otimiza√ß√£o mobile (FlatList, memo, images)
@mobile-optimization check.flatlist src/screens/FeedScreen.tsx

# Valida√ß√£o de prompts de IA
@prompt-testing validate.all promptPath=src/ai/prompts/nathia.system.md

# Migra√ß√£o de sistema legado (futuro)
@design-migration analyze src/components/primitives/Button.tsx
```

**Auto-fix Engine:**
```bash
# Preview de corre√ß√µes (dry-run)
node scripts/cursor-auto-fix.js --file=src/screens/HomeScreen.tsx --dry-run

# Aplicar corre√ß√µes de alta confian√ßa (95%+)
node scripts/cursor-auto-fix.js --file=src/screens/HomeScreen.tsx --confidence=high

# Batch mode (todos os arquivos)
node scripts/cursor-auto-fix.js --mode=batch --confidence=high
```

**Padr√µes Corretos:**
```typescript
// ‚ùå EVITE: Sistema legado + hardcoded values
import { COLORS, SPACING } from '@/design-system';
backgroundColor: '#FFFFFF'
padding: 16

// ‚úÖ CORRETO: Tokens modernos + theme-aware
import { Tokens } from '@/theme/tokens';
import { useThemeColors } from '@/theme';

const colors = useThemeColors();
backgroundColor: colors.background.card  // Suporta dark mode
padding: Tokens.spacing['4']            // 16px
```

**Violations Cr√≠ticas:**
- ‚õî Contraste < 7:1 (WCAG AAA text)
- ‚õî Touch targets < 44pt
- ‚õî Hardcoded colors (#FFFFFF, rgba(0,0,0,0.1), 'white')
- ‚õî Uso de `@/design-system` imports
- ‚õî Missing accessibility labels (accessibilityLabel, accessibilityRole)
- ‚õî Dark mode n√£o testado

---

## PROMPTS R√ÅPIDOS DE USO (Copiar/Colar)

### Para criar novo componente

```
Crie @src/components/organisms/MaternalCard.tsx com 6 variants.
C√≥digo deve ser typescript strict, usar apenas primitives, memoized.
Types em @src/types/component.ts.
Teste b√°sico em tests/MaternalCard.test.tsx
```

### Para integrar IA

```
Integre Gemini chat no @src/services/chatService.ts.
Roteamento via @src/ai/config/llmRouter.ts.
Crisis detection antes de resposta.
Log em Supabase (tokens, provider, custo).
Fallback para GPT-4o se Gemini cair.
```

### Para criar service

```
Crie @src/services/supabase/emotionService.ts.
Fun√ß√µes: saveEmotion(), getTodayEmotion(), getEmotionHistory().
Use tipos de @src/types/user.ts.
RLS-ready (filtra por user.id).
Teste com mocks (n√£o use DB real).
```

### Para refatorar tela

```
Refatore @src/screens/HomeScreen.tsx.
Use MaternalCard (6 blocos).
Aplique design tokens (sem hardcoded colors).
WCAG AAA accessibility labels.
Dark mode support.
Load dados via useSupabase() hook.
```

---

## CHECKLIST DE QUALIDADE

Antes de commitar:
- [ ] TypeScript: `npm run type-check` ‚Üí 0 errors
- [ ] Lint: `npm run lint` ‚Üí 0 critical warnings
- [ ] Tests: `npm test` ‚Üí All green, coverage ‚â• 40% (MVP)
- [ ] Naming: Arquivos em kebab-case, vari√°veis/fun√ß√µes em camelCase
- [ ] No console.log: Use logger
- [ ] No hardcoded colors: Use tokens
- [ ] Accessibility: Labels, 44pt+ touch targets
- [ ] Performance: No unnecessary re-renders (use memo)
- [ ] Commit message: feat|fix|refactor(scope): description

---

## PR√ìXIMAS A√á√ïES AGORA

1. **Clone repo:** `git clone [repo-url] && cd NossaMaternidade`
2. **Setup:** `npm install && npx expo start`
3. **Check TS:** `npm run type-check`
4. **First prompt to Cursor:**

```
"Estou desenvolvendo Nossa Maternidade (app maternal React Native + Expo).
Preciso come√ßar a Fase 1, Week 1: corrigir todos os 16 erros TypeScript.
Repo estrutura: @src, @supabase, @app.json.
Qual √© o erro mais cr√≠tico e como fixar?"
```

---

## Ressources
- Repo: LionGab/NossaMaternidade (GitHub)
- Plano de a√ß√£o: Documento fornecido
- Design System: src/theme/ (Bubblegum palette)
- IA Docs: CLAUDE.md, src/ai/
- BugFix: BUG_FIX_PLAN.md (16 TS errors)

---

**Status: Pronto para Cursor AI come√ßar!** üöÄ

---

## üéØ COMO USAR ESTE PROMPT

### Op√ß√£o 1: Cole Direto no Cursor Chat
1. Abra Cursor AI
2. Cmd+L (ou Ctrl+L no Windows/Linux)
3. Cole TODO o prompt acima
4. Pressione Enter
5. Cursor ter√° contexto completo do projeto

### Op√ß√£o 2: Salve como .cursor/rules
1. Na raiz do projeto, crie pasta `.cursor/`
2. Crie arquivo `rules` (sem extens√£o) ou `instructions.md`
3. Cole o prompt
4. Cursor ler√° automaticamente em toda conversa

### Op√ß√£o 3: Use como Template para Prompts Espec√≠ficos
Depois que tiver contexto, use sub-prompts:

```
"Fase 1, Week 1, Task 1: Corrigir erros TypeScript.
 Rodei npm run type-check e achei 16 errors.
 Primeiro erro: 'Property X does not exist on type Y' em HomeScreen.tsx:45.
 Como fixar? Mostre passo-a-passo."
```

---

## ‚ö° MELHORES PR√ÅTICAS CURSOR (Resumo Executivo)

| Pr√°tica | Por Que | Como |
|---------|---------|------|
| @mentions | Cursor entende contexto de arquivo/pasta | `@HomeScreen.tsx` ou `@src/services` |
| Type-First | TypeScript strict garante qualidade | Pe√ßa tipos ANTES de c√≥digo |
| Composer | Multi-file edits sincronizadas | Cmd+Shift+I, edite m√∫ltiplos em paralelo |
| Commit com Context | Cursor entende relacionamento de commits | Pe√ßa commit message espec√≠fica |
| Debugging | Descreva erro exato | "Erro: TypeError, arquivo: @X, linha Y" |
| Testing | Teste enquanto escreve | Pe√ßa testes + code juntos |
| Refactor Gradual | Evita grandes quebras | Refatore 1 componente/servi√ßo por vez |