#!/bin/bash
# Pre-commit hook - ValidaÃ§Ã£o de Design System
# CompatÃ­vel com Windows (Git Bash) e Unix

echo "ğŸ¨ Nossa Maternidade - Pre-commit Validation"
echo "============================================="

# 1. Validar Design Tokens (crÃ­tico - bloqueia commit)
echo ""
echo "ğŸ“¦ Design Tokens..."
npm run validate:design --silent
if [ $? -ne 0 ]; then
  echo "âŒ Design Tokens falhou!"
  echo ""
  echo "ğŸš« COMMIT BLOQUEADO: ViolaÃ§Ãµes de design tokens encontradas"
  echo "ğŸ’¡ Execute 'npm run validate:design' para ver detalhes"
  echo "ğŸ’¡ Use tokens do design system em vez de cores hardcoded"
  exit 1
fi
echo "âœ… Design Tokens passou"

# 2. TypeScript Check (crÃ­tico - bloqueia commit)
echo ""
echo "ğŸ“¦ TypeScript..."
npm run type-check --silent
TS_RESULT=$?
if [ $TS_RESULT -ne 0 ]; then
  echo "âŒ TypeScript falhou!"
  echo ""
  echo "ğŸš« COMMIT BLOQUEADO: Erros de TypeScript encontrados"
  echo "ğŸ’¡ Execute 'npm run type-check' para ver detalhes"
  exit 1
fi
echo "âœ… TypeScript passou"

# 3. Lint-staged (arquivos modificados)
echo ""
echo "ğŸ§¹ Executando lint nos arquivos staged..."
npx lint-staged --quiet
if [ $? -ne 0 ]; then
  echo ""
  echo "ğŸš« COMMIT BLOQUEADO: Erros de lint encontrados"
  echo "ğŸ’¡ Execute 'npm run lint' para ver detalhes"
  exit 1
fi

echo ""
echo "============================================="
echo "âœ… Todas as validaÃ§Ãµes passaram!"
echo "ğŸš€ Commit autorizado - Nossa Maternidade"
echo "============================================="
exit 0
